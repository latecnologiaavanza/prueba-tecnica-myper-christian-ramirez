@model List<PruebaTecnicaMyper.Models.Trabajador>

<div class="container py-4">
    <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Mantenimiento de Trabajadores</h5>
            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalTrabajador" onclick="nuevoTrabajador()">
                + Nuevo Trabajador
            </button>
        </div>

        <div class="card-body">
            <form method="get" class="row g-3 mb-4 align-items-end">
                <div class="col-md-3">
                    <label for="sexo" class="form-label">Sexo</label>
                    <select id="sexo" name="sexo" class="form-select">
                        <option value="">-- Todos --</option>
                        <option value="Masculino" selected="@(ViewBag.SexoSeleccionado == "Masculino")">Masculino</option>
                        <option value="Femenino" selected="@(ViewBag.SexoSeleccionado == "Femenino")">Femenino</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex">
                    <button type="submit" class="btn btn-secondary w-100">Filtrar</button>
                </div>
            </form>

            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Foto</th>
                            <th scope="col">Nombres</th>
                            <th scope="col">Apellidos</th>
                            <th scope="col">Documento</th>
                            <th scope="col">Sexo</th>
                            <th scope="col" style="width:180px">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Any())
                        {
                            foreach (var t in Model)
                            {
                                <tr class="@(t.Sexo == "Masculino" ? "table-primary" : "table-warning")">
                                    <td class="text-center">
                                        <img src="@(string.IsNullOrEmpty(t.FotoPath) ? "/images/default.png" : t.FotoPath)"
                                             width="40" height="40" class="rounded-circle border" />
                                    </td>
                                    <td>@(t.Nombres ?? "-")</td>
                                    <td>@(t.Apellidos ?? "-")</td>
                                    <td>@(t.TipoDocumento ?? "-") @(t.NumeroDocumento ?? "-")</td>
                                    <td>@(t.Sexo ?? "-")</td>
                                    <td>
                                        <div class="d-flex justify-content-center gap-2">
                                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#modalTrabajador"
                                                    data-id="@t.Id" data-nombres="@t.Nombres" data-apellidos="@t.Apellidos"
                                                    data-tipodocumento="@t.TipoDocumento" data-numerodocumento="@t.NumeroDocumento"
                                                    data-sexo="@t.Sexo" data-direccion="@t.Direccion"
                                                    data-fechanacimiento="@t.FechaNacimiento?.ToString("yyyy-MM-dd")"
                                                    onclick="editarTrabajador(this)">
                                                Editar
                                            </button>
                                            <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#modalEliminar"
                                                    data-id="@t.Id" data-nombre="@t.Nombres" data-apellido="@t.Apellidos">
                                                Eliminar
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6" class="text-center py-3">No hay trabajadores registrados</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalTrabajador" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="tituloModal">Formulario de Trabajador</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalBodyTrabajador">
                @await Html.PartialAsync("_Create", new PruebaTecnicaMyper.Models.Trabajador())
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="modalEliminar" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirmar eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                ¿Está seguro de eliminar al trabajador <strong id="nombreTrabajador"></strong>?
            </div>
            <div class="modal-footer">
                <form asp-action="ConfirmDelete" method="post">
                    <input type="hidden" name="id" id="idTrabajador" />
                    <button type="submit" class="btn btn-danger">Sí, eliminar</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const modalEliminar = document.getElementById('modalEliminar');
        modalEliminar.addEventListener('show.bs.modal', function (event) {
            const btn = event.relatedTarget;
            document.getElementById('idTrabajador').value = btn.dataset.id;
            document.getElementById('nombreTrabajador').textContent = btn.dataset.nombre + ' ' + btn.dataset.apellido;
        });

        function nuevoTrabajador() {
            document.getElementById('tituloModal').innerText = 'Registrar Trabajador';
            document.getElementById('formTrabajador').reset();
            document.getElementById('Id').value = 0;
        }

        function editarTrabajador(btn) {
            document.getElementById('tituloModal').innerText = 'Editar Trabajador';
            document.getElementById('Id').value = btn.dataset.id;
            document.getElementById('Nombres').value = btn.dataset.nombres;
            document.getElementById('Apellidos').value = btn.dataset.apellidos;
            document.getElementById('TipoDocumento').value = btn.dataset.tipodocumento;
            document.getElementById('NumeroDocumento').value = btn.dataset.numerodocumento;
            document.getElementById('Sexo').value = btn.dataset.sexo;
            document.getElementById('Direccion').value = btn.dataset.direccion;
            document.getElementById('FechaNacimiento').value = btn.dataset.fechanacimiento;
        }
    </script>
}